/*!
 * ParamQuery Pro v3.5.0
 * 
 * Copyright (c) 2012-2021 Paramvir Dhindsa (http://paramquery.com)
 * Released under GNU General Public License v3
 * http://paramquery.com/license
 * 
 */
 
!function(t){function e(t){for(var e,o,n,r=0,i=t.length;i>r;r++)e=t[r],(o=e.template)&&(n=!0,e.render=function(t){return function(e){return t}}(o));return n}function o(t){var e,o=t.pq_ko;if(o)for(e in o)o[e].dispose()}function n(o,n,r){var a,s,u=this,d=n(),f=i.timer(),c=i.timer(),l=d.colModel,p=d.koModel||{},h=e(l||[])||p.bind,g=d.dataModel,m=g.data,w=p.item,k="function"==typeof m?m:null;d.refresh=function(){h&&u.onRefresh(this)},u.element=o,u.timerItem=i.timer(),u.context=r,k&&(a=k(),w||!a[0]||t.isPlainObject(a[0])||(w=a[0].constructor),d.dataModel.data=u.importData(a,w),u.subscribeKoDataChange(k,w,f)),u.koItem=w,s=pq.grid(o,d),u.grid=s,s.on("sort filter load",u.onSortFilterLoad(u,k,w,c)).on("change",u.onChange(u,k,w,c)).on("refreshRow refreshCell",u.onRefreshRowCell(u,h)),ko.utils.domNodeDisposal.addDisposeCallback(o,function(){s.destroy()})}var r=t.paramquery.pqGrid.prototype;r.totalRows=r.totalRows||function(){var t=this.options.dataModel,e=t.data,o=t.dataUF||[];return e.length+o.length};var i={timer:function(){var t;return{setTimeout:function(e){t&&ko.tasks.cancel(t),t=ko.tasks.schedule(e)}}}},a=n.prototype;a.onChange=function(t,e,o,n){return function(r,i){if(e){var a=i.rowList;if(1==a.length&&"update"==a[0].type){var s=a[0],u=s.rowData.pq_ko_item,d=s.newRow;for(var f in d)u[f](d[f])}else t.inChange=!0,n.setTimeout(function(){e(t.exportData(o)),t.inChange=!1})}}},a.onSortFilterLoad=function(t,e,o,n){return function(r){e&&(t.inChange=!0,n.setTimeout(function(){e(t.exportData(o)),t.inChange=!1}))}},a.onRefreshRowCell=function(t,e){return function(o,n){if(e){var r=this.getRow(n);ko.cleanNode(r[0]),t.rowScope(r,n.rowData,n.rowIndx)}}},a.disposeData=function(){for(var t=this.grid.option("dataModel.data"),e=0,n=t.length;n>e;e++)o(t[e])},a.subscribe=function(t,e,o,n){var r=this.timerItem,i=this;n[o]=n[o]||t.subscribe(function(t){e[o]=t,r.setTimeout(function(){i.grid.refresh({header:!1})})})},a.importData=function(t,e){var o=[],n=this;return e?(ko.utils.arrayMap(t,function(t){o.push(n.importRow(t,e))}),o):t},a.importRow=function(t,e){var o,n,r;if(e){r={},o={pq_ko:r};for(var i in t)n=t[i],this.subscribe(n,o,i,r),o[i]=n();return o.pq_ko_item=t,o}return t},a.exportRow=function(t){var e,o,n,r=t.pq_ko_item;if(r)for(n in r)r[n](t[n]);else{r=new koItem(t),t.pq_ko=e=t.pq_ko||{};for(n in r)o=r[n],this.subscribe(o,t,n,e)}return r},a.exportData=function(t){var e,o=this,n=o.grid.options.dataModel.data,r=[];return t?(ko.utils.arrayMap(n,function(t){e=o.exportRow(t),r.push(e)}),r):n},a.importArrayChanges=function(t,e){var n,r,i,a,s=t.length,u=this.grid.option("dataModel.data");if(s>u.length)return!0;for(;s--;)r=t[s],i=r.status,a=r.index,"added"==i?(n=this.importRow(r.value,e),u.splice(a,0,n)):"deleted"==i&&(o(u[a]),u.splice(a,1))},a.rowScope=function(t,e,o){var n=this.context.extend({rd:e.pq_ko_item||e,ri:o});ko.applyBindingsToDescendants(n,t[0])},a.subscribeKoDataChange=function(t,e,o){var n,r,i=this;t&&(t.subscribe(function(t){i.inChange||n||(n=!e||i.importArrayChanges(t,e),o.setTimeout(function(){i.grid.refreshView()}))},null,"arrayChange"),t.subscribe(function(a){if(!i.inChange&&n){if(t()!=a)throw"koData != arr assert failed";r=i.grid,o.setTimeout(function(){e&&i.disposeData(),r.option("dataModel.data",i.importData(t(),e)),r.refreshView()}),n=!1}}))},a.onRefresh=function(e){for(var o,n,r,i=0,a=this.element.querySelectorAll(".pq-grid-row"),s=a.length;s>i;i++)r=t(a[i]),o=e.getRowIndx({$tr:r}),n=e.getRowData(o),this.rowScope(r,n,o.rowIndx)},ko.bindingHandlers.pqGrid={init:function(t,e,o,r,i){return new n(t,e,i),{controlsDescendantBindings:!0}}}}(jQuery);